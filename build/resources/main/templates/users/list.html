<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"> <head>
    <title th:text="${pageTitle}"></title>
            <link rel="stylesheet" 
          type="text/css" 
          th:href="@{/css/styleU.css}">
</head>
<div layout:fragment="content">
    
    <h1 class="display-5" th:text="${pageTitle}">Gestion des Utilisateurs</h1>

    <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}">
        Message de succès.
    </div>

    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom d'utilisateur</th>
                <th>Rôle</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.id}">1</td>
                <td th:text="${user.username} ?: 'N/A'">user.name</td>
                <td th:text="${user.role} ?: 'AUCUN RÔLE'">RH</td>
                <td>
                    <div sec:authorize="hasAnyRole('ADMIN', 'DRH')">
                        <form th:action="@{/users/delete/{id}(id=${user.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-danger" 
                                    onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur?');">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </form>
                    </div>
                    
                    <div sec:authorize="!hasAnyRole('ADMIN','DRH')">
                        Pas d'action disponible
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    
    <a sec:authorize="hasRole('ADMIN')" th:href="@{/homeADMIN}" class="btn btn-secondary mt-3">
        <i class="fas fa-arrow-left"></i> Retour à l'accueil Admin
    </a>
    <a sec:authorize="hasRole('DRH')" th:href="@{/homeDRH}" class="btn btn-secondary mt-3">
        <i class="fas fa-arrow-left"></i> Retour à l'accueil DRH
    </a>
</div>
</html>